<!DOCTYPE html>
<html>
<head>
    {embed="/_includes/dnd-header"}
    <title>Character Builder</title>
</head>
<body>
    {embed="/_includes/nav"}
    <div class="container character-sheet">
        <h1>
            Character Builder
        </h1>

        <?php 
            error_reporting(E_ALL);
            require_once $_SERVER['DOCUMENT_ROOT']."/assets/php/character-generator.php";

            if (isset($_POST['entered'])){
                $character_name = $process->validateText($_POST['character_name']);
                $character_race = $process->validateText($_POST['character_race']);
                $character_class = $process->validateText($_POST['character_class']);
                $strength = $process->validateText($_POST['strength']);
                $constitution = $process->validateText($_POST['constitution']);
                $dexterity = $process->validateText($_POST['dexterity']);
                $intelligence = $process->validateText($_POST['intelligence']);
                $wisdom = $process->validateText($_POST['wisdom']);
                $charisma = $process->validateText($_POST['charisma']);
                $character_alignment = $_POST['character_alignment'];
                $skills = $_POST['skill'];

                $inputs = array("character_name"=>$character_name, "character_race"=>$character_race, "character_class"=>$character_class,"strength"=>$strength,"constitution"=>$constitution,"dexterity"=>$dexterity,"intelligence"=>$intelligence,"wisdom"=>$wisdom,"charisma"=>$charisma,"character_alignment"=>$character_alignment,"skills"=>$skills);

                $process->addData($inputs);
            }
        ?>

        <script>
            showSubraces("dwarf");

            function showSubraces(str){
                console.log(str);
                if(str.length == 0){
                    document.getElementById("subracetest").innerHTML = "";
                }else{
                    var xmlHttp = new XMLHttpRequest();
                    xmlHttp.onreadystatechange = function(){
                        if (this.readyState == 4 && this.status == 200){
                            if(this.responseText[0] != "A"){
                                document.getElementById("subraceouter").style.display = "inline-block";
                                document.getElementById("subracetest").innerHTML = this.responseText;
                            }else{
                                document.getElementById("subraceouter").style.display = "none";
                            }
                        }
                    };
                    xmlHttp.open("GET", "/assets/php/ajax-character-builder.php?q=" + str, true);
                    xmlHttp.send();
                }
            }
        </script>

        <form action="" method="post">
            <ul class="inputs">
                <li>NAME: <input type="text" name="character_name"></li>
                <li>RACE: <select name="character_mainrace" onchange='showSubraces(this.value)'>
                    <?php 
                    $races = $process->getRaces("race_name","");
                    foreach($races as $race){
                        $race_name = $race['race_name'];
                        echo "<option value='$race_name'>$race_name</option>\n";
                    }
                    ?>
                </select>
                <div class="arrow"></div>
                </li>
                <li id="subraceouter" style="display:none;">
                    SUBRACE: <select id="subracetest" name="character_subrace">
                    </select>
                    <div class="arrow"></div>
                </li>
                <li>CLASS: <input type="text" name="character_class"></li>
                <li>ALIGNMENT: <select name="character_alignment">
                    <option value="lawful_good">Lawful Good</option>
                    <option value="neutral_good">Neutral Good</option>
                    <option value="chaotic_good">Chaotic Good</option>
                    <option value="lawful_neutral">Lawful Neutral</option>
                    <option value="true_neutral">True Neutral</option>
                    <option value="chaotic_neutral">Chaotic Neutral</option>
                    <option value="lawful_evil">Lawful Evil</option>
                    <option value="neutral_evil">Neutral Evil</option>
                    <option value="chaotic_evil">Chaotic Evil</option>
                </select>
                <div class="arrow"></div></li>
            </ul>
            <hr>
            <h2>Attributes</h2>
            <div class="clearfix"></div>
            <ul class="inputs attributes">
                <li>STR: <input type="number" name="strength"></li>
                <li>CON: <input type="number" name="constitution"></li>
                <li>DEX: <input type="number" name="dexterity"></li>
            </ul>
            <ul class="inputs attributes">
                <li>INT: <input type="number" name="intelligence"></li>
                <li>WIS: <input type="number" name="wisdom"></li>
                <li>CHA: <input type="number" name="charisma"></li>
            </ul>
            <hr>
            <h2>Skills</h2>
            <div class="clearfix"></div>
            <ul class="inputs attributes">
                <li><input type="checkbox" name="skill[]" value="acrobatics"><span>Acrobatics</li><li>
                <input type="checkbox" name="skill[]" value="animal_handling"><span>animal handling</li><li>
                <input type="checkbox" name="skill[]" value="arcana"><span>arcana</li><li>
                <input type="checkbox" name="skill[]" value="athletics"><span>Athletics</li><li>
                <input type="checkbox" name="skill[]" value="deception"><span>deception</li><li>
                <input type="checkbox" name="skill[]" value="history"><span>history</li>
            </ul>
            <ul class="inputs attributes">
                <li><input type="checkbox" name="skill[]" value="insight"><span>insight</li><li>
                <input type="checkbox" name="skill[]" value="intimidation"><span>intimidation</li><li>
                <input type="checkbox" name="skill[]" value="investigation"><span>investigation</li><li>
                <input type="checkbox" name="skill[]" value="medicine"><span>medicine</li><li>
                <input type="checkbox" name="skill[]" value="nature"><span>nature</li><li>
                <input type="checkbox" name="skill[]" value="perception"><span>perception</li>
            </ul>
            <ul class="inputs attributes"> 
                <li><input type="checkbox" name="skill[]" value="performance"><span>performance</li>
                <li><input type="checkbox" name="skill[]" value="persuasion"><span>persuasion</li><li>
                <input type="checkbox" name="skill[]" value="religion"><span>religion</li><li>
                <input type="checkbox" name="skill[]" value="sleight_of_hand"><span>sleight of hand</li><li>
                <input type="checkbox" name="skill[]" value="stealth"><span>stealth</li><li>
                <input type="checkbox" name="skill[]" value="survival"><span>survival</li>
            </ul>
            <div class="clearfix"></div>
            <hr>
            <input type="hidden" name="csrf_token" value="{csrf_token}">
            <button type="submit" name="entered">SUBMIT</button>
            </ul>
        </form>
    </div>
</body>
</html>