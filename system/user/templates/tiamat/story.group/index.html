<!doctype html>

<html lang="en">
<head>
    {embed=/_includes/dnd-header}
    <title>The story so far...</title>
</head>
<body>

    <?php
        $profileBoxes['test-channel'] = "test-profile";
        $testChannel = "characters";
        $testProfile = "addam-westbeard";
    ?>
    <script>

    function showBox(profile){
        console.log(profile);
        document.getElementById(profile).classList.toggle("hidden");
    }

    function moveDivs(event)
        {
            x=event.screenX;
            y=event.screenY;
            
        {exp:channel:entries channel="characters"}
            document.getElementById("{url_title}").style.left=x+"px";
            document.getElementById("{url_title}").style.top=(y-60)+"px";
        {/exp:channel:entries}

        }

        window.addEventListener("hashchange", function(){
        window.scrollTo(window.scrollX, window.scrollY - 75);
    });
    </script>

    {embed="/_includes/nav"}

    <div class="container" id="top" onmousemove="moveDivs(event)">
        <div class="h1-container" id="top">
            <h1>The Story So Far...</h1>
        </div>
        
        <div class="menu">
            {exp:channel:entries channel="story" status="not closed" orderby="chapter" sort="asc"}
                <li><a class="thin" href="#{url_title}">{title}</a></li>
            {/exp:channel:entries}
        </div>

        {exp:channel:entries channel="story" status="not closed" orderby="chapter" sort="asc"}
            <div class="chapter" id="{url_title}">

                <h2>Chapter {chapter}</h2>

                <h3>{title}</h3>

                <p>
                    {exp:low_replace
                        regex="yes"
                        find="<a channel=QUOTE(.*?)QUOTE profile=QUOTE(.*?)QUOTE>"
                        replace="<a href='/$1/profile/$2' target='_blank' onmouseover=QUOTEshowBox('$2')QUOTE onmouseout=QUOTEshowBox('$2')QUOTE> <?php $profileBoxes['$1'] = '$2'; ?>"
                    }
                        {what-happened}
                    {/exp:low_replace}
                </p>

           </div>

        {/exp:channel:entries}
    </div>

    <a href="#top" class="top-arrow">
        <img src="/assets/images/arrow-up.svg" />
    </a>
    
    {exp:channel:entries channel='<?php $testChannel ?>' url_title='<?php $testProfile ?>'}
    <div class='profile-box hidden categories' id='{url_title}'>
                    <ul>    
                        {categories orderby='asc'}
                        <li style='background-color:{colour}'>
                            <h4>{category_name}</h4>
                        </li>
                        {/categories}
                    </ul>
                    <h2>{title}</h2>
                    <p>{standfirst}</p>
                </div>
    {/exp:channel:entries}

    <?php 
    var_dump($profileBoxes);
    foreach ($profileBoxes as $boxChannel => $boxProfile) {
        echo "{exp:channel:entries channel='<?php $boxChannel ?>' url_title='<?php $boxProfile ?>'}
                <div class='profile-box hidden categories' id='{url_title}'>
                    <ul>    
                        {categories orderby='asc'}
                        <li style='background-color:{colour}'>
                            <h4>{category_name}</h4>
                        </li>
                        {/categories}
                    </ul>
                    <h2>{title}</h2>
                    <p>{standfirst}</p>
                </div>
        {/exp:channel:entries}"; 
    }
    ?>
    
</body>
</html>